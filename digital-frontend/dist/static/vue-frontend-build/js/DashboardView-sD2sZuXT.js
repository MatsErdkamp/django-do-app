import{_ as S,r as l,o as m,a as n,c as s,t as v,F as y,b,d as h,p as $,e as C,n as D,f as x,g as w}from"./index-BjQj7IvS.js";const I=i=>($("data-v-58190036"),i=i(),C(),i),B=I(()=>h("h1",null,"Calendar Data",-1)),E={key:0},F={key:1,class:"error"},N={key:2},L={class:"calendar-item"},R={__name:"DashboardCalendar",setup(i){const _=l(null),o=l(!1),d=l(null),p={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};function c(r){return new Intl.DateTimeFormat("en-US",p).format(new Date(r))}function e(r){let t="https://charging-twin-qw8ag.ondigitalocean.app";return(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(t="localhost:8000"),t+r}async function u(){o.value=!0;let r=e("/api/calendar");try{const t=await fetch(r);if(!t.ok)throw new Error("Failed to fetch");const a=await t.json();_.value=a[0].google_response.items}catch(t){d.value=t.message}finally{o.value=!1}}return m(()=>{u()}),(r,t)=>(n(),s("div",null,[B,o.value?(n(),s("div",E,"Loading...")):d.value?(n(),s("div",F,v(d.value),1)):(n(),s("div",N,[(n(!0),s(y,null,b(_.value,a=>(n(),s("div",L,[h("h2",null,v(a.summary),1),h("div",null,v(c(a.start.dateTime)),1)]))),256))]))]))}},U=S(R,[["__scopeId","data-v-58190036"]]),k=i=>($("data-v-3738de08"),i=i(),C(),i),W=k(()=>h("h1",null,"Battery State",-1)),H={key:0},T={key:1,class:"error"},j={key:2},M={class:"calendar-item"},O=k(()=>h("div",null,"NOT CONNECTED",-1)),P={style:{"border-top":"1px solid #212121","margin-top":"8px","padding-top":"4px"}},V=k(()=>h("div",null,"For 100% charge",-1)),q={__name:"DashboardBattery",props:{charge:Number,hours:String},setup(i){const _=l(null),o=l(!1),d=l(null),p=i;async function c(){o.value=!0;try{const e=await fetch("http://127.0.0.1:8000/api/calendar/");if(!e.ok)throw new Error("Failed to fetch");const u=await e.json();_.value=u[0].google_response.items}catch(e){d.value=e.message}finally{o.value=!1}}return m(()=>{c()}),(e,u)=>(n(),s("div",null,[W,o.value?(n(),s("div",H,"Loading...")):d.value?(n(),s("div",T,v(d.value),1)):(n(),s("div",j,[h("div",M,[h("h2",null,v(p.charge)+"%",1),O,h("h2",P,v(p.hours),1),V])]))]))}},z=S(q,[["__scopeId","data-v-3738de08"]]),J=h("h1",null,"Charge Moments",-1),A={class:"charge-histogram"},G={class:"charge-histogram-charging-indicator"},K=["onClick"],Q={__name:"DashboardHistogram",setup(i){const _=l(10),o=l(!0);function d(t,a){return a==_.value?"background:orange;":t==!1?"background:red;":"background:green;"}l([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function p(t){_.value=t,r()}function c(t){let a="https://charging-twin-qw8ag.ondigitalocean.app";return(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(a="localhost:8000"),a+t}const e=l(null),u=l(null);async function r(){o.value=!0;let t=c("/api/curve/");try{const a=await fetch(t+"?deadline="+_.value);if(!a.ok)throw new Error("Failed to fetch");const g=await a.json();u.value=g.best_options,e.value=g.scores.split(",").map(function(f){return parseInt(f,10)})}catch(a){a.value=a.message}finally{o.value=!1}}return m(()=>{r()}),(t,a)=>(n(),s("div",null,[J,h("div",A,[(n(!0),s(y,null,b(e.value,(g,f)=>(n(),s("div",{class:"price-bar",style:D({height:g+"%"})},null,4))),256))]),h("div",G,[(n(!0),s(y,null,b(u.value,(g,f)=>(n(),s("div",{class:"charge-bar",style:D(d(g,f)),onClick:Y=>p(f)},null,12,K))),256))])]))}},X={class:"dashboard-container"},ee={__name:"DashboardView",setup(i){function _(){var c=window.location.protocol==="https:"?"wss:":"ws:",e=window.location.host;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(e="localhost:8000");var u="/ws/car/",r=c+"//"+e+u;return new WebSocket(r)}let o=_();const d=l(0),p=l(0);return m(()=>{o.onopen=function(){console.log("WebSocket connected.")},o.onmessage=function(c){var t,a;const e=JSON.parse(c.data);let u=(t=e==null?void 0:e.car)==null?void 0:t.battery_percentage;u!=null&&(d.value=u);let r=(a=e==null?void 0:e.car)==null?void 0:a.estimated_time_until_full;r!=null&&(p.value=r)},o.onerror=function(c){console.log("WebSocket Error: ",c)},o.onclose=function(c){console.log("WebSocket closed.")}}),x(()=>{o.close()}),(c,e)=>(n(),s("div",X,[w(U,{class:"dashboard-item"}),w(z,{class:"dashboard-item",charge:d.value,hours:p.value},null,8,["charge","hours"]),w(Q,{class:"dashboard-item"})]))}};export{ee as default};
