import{_ as $,r as i,o as k,a as o,c as a,t as m,F as b,b as y,d as h,p as C,e as x,w as I,n as S,f as R,g as w}from"./index-DDqeJtOF.js";const N=c=>(C("data-v-07354cc4"),c=c(),x(),c),q=N(()=>h("h1",null,"Calendar Data",-1)),B={key:0},E={key:1,class:"error"},F={key:2},L={class:"calendar-item"},U={__name:"DashboardCalendar",setup(c){const _=i(null),n=i(!1),u=i(null),g={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};function d(r){return new Intl.DateTimeFormat("en-US",g).format(new Date(r))}function s(r){let t="https://charging-twin-qw8ag.ondigitalocean.app";return(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(t="http://localhost:8000"),t+r}async function p(){n.value=!0;let r=s("/api/calendar/");try{const t=await fetch(r);if(!t.ok)throw new Error("Failed to fetch");const e=await t.json();_.value=e[0].google_response.items}catch(t){u.value=t.message}finally{n.value=!1}}return k(()=>{p()}),(r,t)=>(o(),a("div",null,[q,n.value?(o(),a("div",B,"Loading...")):u.value?(o(),a("div",E,m(u.value),1)):(o(),a("div",F,[(o(!0),a(b,null,y(_.value,e=>(o(),a("div",L,[h("h2",null,m(e.summary),1),h("div",null,m(d(e.start.dateTime)),1)]))),256))]))]))}},W=$(U,[["__scopeId","data-v-07354cc4"]]),D=c=>(C("data-v-913e48d8"),c=c(),x(),c),H=D(()=>h("h1",null,"Battery State",-1)),T={key:0},M={key:1,class:"error"},O={key:2},P={class:"calendar-item"},V=D(()=>h("div",null,"NOT CONNECTED",-1)),j={style:{"border-top":"1px solid #212121","margin-top":"8px","padding-top":"4px"}},z=D(()=>h("div",null,"For 100% charge",-1)),J={__name:"DashboardBattery",props:{charge:Number,hours:Number},setup(c){i(null);const _=i(!1),n=i(null),u=c;return(g,d)=>(o(),a("div",null,[H,_.value?(o(),a("div",T,"Loading...")):n.value?(o(),a("div",M,m(n.value),1)):(o(),a("div",O,[h("div",P,[h("h2",null,m(u.charge)+"%",1),V,h("h2",j,m(u.hours)+" hours ",1),z])]))]))}},A=$(J,[["__scopeId","data-v-913e48d8"]]),G=h("h1",null,"Charge Moments",-1),K={class:"charge-histogram"},Q={class:"charge-histogram-charging-indicator"},X=["onClick"],Y={__name:"DashboardHistogram",props:{hoursRequired:Number},setup(c){const _=i(10),n=i(!0),u=c;function g(e,l){return l==_.value?"background:orange;":e==!1?"background:red;":"background:green;"}i([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function d(e){_.value=e,t()}function s(e){let l="https://charging-twin-qw8ag.ondigitalocean.app";return(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(l="http://localhost:8000"),l+e}const p=i(null),r=i(null);I(()=>u.hoursRequired,(e,l)=>{t()});async function t(){n.value=!0;let e=s("/api/curve/");try{const l=await fetch(e+"?deadline="+_.value+"&hours="+u.hoursRequired);if(!l.ok)throw new Error("Failed to fetch");const v=await l.json();r.value=v.best_options,p.value=v.scores.split(",").map(function(f){return parseInt(f,10)})}catch(l){l.value=l.message}finally{n.value=!1}}return k(()=>{t()}),(e,l)=>(o(),a("div",null,[G,h("div",K,[(o(!0),a(b,null,y(p.value,(v,f)=>(o(),a("div",{class:"price-bar",style:S({height:v+"%"})},null,4))),256))]),h("div",Q,[(o(!0),a(b,null,y(r.value,(v,f)=>(o(),a("div",{class:"charge-bar",style:S(g(v,f)),onClick:ee=>d(f)},null,12,X))),256))])]))}},Z={class:"dashboard-container"},oe={__name:"DashboardView",setup(c){function _(){var d=window.location.protocol==="https:"?"wss:":"ws:",s=window.location.host;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&(s="localhost:8000");var p="/ws/car/",r=d+"//"+s+p;return new WebSocket(r)}let n=_();const u=i(0),g=i(0);return k(()=>{n.onopen=function(){console.log("WebSocket connected.")},n.onmessage=function(d){var t,e;const s=JSON.parse(d.data);let p=(t=s==null?void 0:s.car)==null?void 0:t.battery_percentage;p!=null&&(u.value=p);let r=(e=s==null?void 0:s.car)==null?void 0:e.estimated_time_until_full;if(r!=null){let v=parseInt(r,10);g.value=v}},n.onerror=function(d){console.log("WebSocket Error: ",d)},n.onclose=function(d){console.log("WebSocket closed.")}}),R(()=>{n.close()}),(d,s)=>(o(),a("div",Z,[w(W,{class:"dashboard-item"}),w(A,{class:"dashboard-item",charge:u.value,hours:g.value},null,8,["charge","hours"]),w(Y,{class:"dashboard-item",hoursRequired:g.value},null,8,["hoursRequired"])]))}};export{oe as default};
